<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Shorts 폴더 기반 미디어 매니저</title>
    <link rel="stylesheet" href="folder-styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>📁 YouTube Shorts 폴더 미디어 매니저</h1>
            <div class="connection-status">
                <span id="connectionStatus" class="status-disconnected">● 연결 안됨</span>
            </div>
        </header>

        <div class="main-layout">
            <!-- 왼쪽: 다운로드 폴더 -->
            <div class="download-section">
                <div class="section-header">
                    <h2>📥 다운로드 폴더</h2>
                    <div class="header-actions">
                        <button id="selectAllBtn" class="select-btn">☑️ 전체선택</button>
                        <button id="batchRenameBtn" class="batch-btn" style="display: none;">✏️ 일괄변경</button>
                        <button id="batchMoveBtn" class="move-btn" style="display: none;">📁 일괄이동</button>
                        <button id="refreshDownloads" class="refresh-btn">🔄 새로고침</button>
                    </div>
                </div>
                <div class="download-info">
                    <p id="downloadCount">파일 0개 대기 중</p>
                    <p id="selectedCount" style="display: none;">선택된 파일: 0개</p>
                </div>
                <div class="download-controls">
                    <div class="sort-controls">
                        <label>정렬:</label>
                        <select id="sortSelect">
                            <option value="name">이름순</option>
                            <option value="date">저장순 (최신)</option>
                            <option value="date-old">저장순 (오래된)</option>
                            <option value="size">크기순</option>
                        </select>
                    </div>
                    <div class="filter-controls">
                        <label>필터:</label>
                        <input type="text" id="filterInput" placeholder="파일명으로 검색...">
                        <select id="typeFilter">
                            <option value="all">모든 파일</option>
                            <option value="image">이미지만</option>
                            <option value="video">비디오만</option>
                        </select>
                    </div>
                </div>
                <div class="download-files" id="downloadFiles">
                    <!-- 다운로드 폴더의 파일들이 여기 표시됨 -->
                </div>
            </div>

            <!-- 오른쪽: 카테고리 폴더 -->
            <div class="categories-section">
                <div class="section-header">
                    <h2>📂 카테고리 폴더</h2>
                    <button id="addCategoryBtn" class="add-btn">+ 새 카테고리</button>
                </div>
                <div class="categories-grid" id="categoriesGrid">
                    <!-- 카테고리 폴더들이 여기 표시됨 -->
                </div>
            </div>
        </div>

        <!-- 자동 분류 패널 -->
        <div class="auto-sort-panel">
            <div class="auto-sort-header">
                <button id="autoSortSettingsBtn" class="settings-menu-btn">⚙️ 자동 분류 설정</button>
                <button id="autoSortBtn" class="auto-sort-btn">🚀 자동 분류 실행</button>
            </div>
            
            <div class="auto-sort-settings" id="autoSortSettings" style="display: none;">
                <div class="settings-header">
                    <h4>🤖 자동 분류 규칙 관리</h4>
                    <button id="closeSettingsBtn" class="close-settings-btn">✕</button>
                </div>
                <div class="auto-sort-rules" id="autoSortRules">
                    <div class="rule-item">
                        <input type="text" placeholder="키워드 (예: 여행, travel)" class="keyword-input">
                        <select class="category-select">
                            <option value="">카테고리 선택</option>
                        </select>
                        <button class="remove-rule">❌</button>
                    </div>
                </div>
                <div class="settings-actions">
                    <button id="addRuleBtn" class="add-rule-btn">+ 규칙 추가</button>
                    <button id="saveSettingsBtn" class="save-settings-btn">💾 설정 저장</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 파일 미리보기 모달 -->
    <div class="preview-modal" id="previewModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="preview-container">
                <img id="previewImage" style="display: none;">
                <video id="previewVideo" controls style="display: none;"></video>
            </div>
            <div class="file-info">
                <div class="file-header">
                    <h3 id="fileName"></h3>
                    <button id="renameFileBtn" class="rename-file-btn" title="파일 이름 변경">✏️</button>
                </div>
                <p id="fileDetails"></p>
                <div class="category-selector">
                    <label>카테고리 선택:</label>
                    <select id="categorySelect">
                        <option value="">선택하세요</option>
                    </select>
                    <button id="moveFileBtn">📁 이동</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 새 카테고리 모달 -->
    <div class="modal" id="categoryModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>새 카테고리 폴더 생성</h3>
            <form id="categoryForm">
                <input type="text" id="categoryName" placeholder="카테고리 이름" required>
                <button type="submit">생성</button>
            </form>
        </div>
    </div>

    <!-- 폴더 이름 변경 모달 -->
    <div class="modal" id="renameFolderModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>폴더 이름 변경</h3>
            <form id="renameFolderForm">
                <div class="rename-info">
                    <p>현재 이름: <strong id="currentFolderName"></strong></p>
                    <p>위치: <strong id="currentFolderPath"></strong></p>
                </div>
                <input type="text" id="newFolderName" placeholder="새 폴더 이름" required>
                <input type="hidden" id="renameCategory" value="">
                <input type="hidden" id="renameOldName" value="">
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn">취소</button>
                    <button type="submit" class="confirm-btn">변경</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 카테고리 내용 보기 모달 -->
    <div id="categoryContentModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 90%; max-height: 90%;">
            <span class="close-modal">&times;</span>
            <div class="category-content-header">
                <h2 id="categoryContentTitle">📂 카테고리</h2>
                <div class="category-actions">
                    <div class="category-info">
                        <span id="categoryFileCount">0개 파일</span>
                        <span id="categorySelectedCount" style="display: none;">선택된 파일: 0개</span>
                    </div>
                    <div class="category-header-actions">
                        <button id="categorySelectAllBtn" class="select-btn">☑️ 전체선택</button>
                        <button id="categoryBatchRenameBtn" class="batch-btn" style="display: none;">✏️ 일괄변경</button>
                        <button id="categoryBatchMoveBtn" class="move-btn" style="display: none;">📁 일괄이동</button>
                        <button id="openCategoryFolderBtn" class="open-category-folder-btn">📂 폴더 열기</button>
                    </div>
                </div>
            </div>
            <div id="categoryFilesGrid" class="category-files-grid">
                <!-- 카테고리 파일들이 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <!-- 확인 모달 -->
    <div class="modal" id="confirmModal" style="display: none;">
        <div class="modal-content confirm-modal-content">
            <h3 id="confirmTitle">확인</h3>
            <p id="confirmMessage"></p>
            <div class="modal-buttons">
                <button type="button" class="cancel-btn" id="confirmCancel">취소</button>
                <button type="button" class="confirm-btn" id="confirmOk">확인</button>
            </div>
            <div class="confirm-hint">
                <small>스페이스바로 확인, ESC로 취소</small>
            </div>
        </div>
    </div>

    <!-- 일괄 이름 변경 모달 -->
    <div class="modal" id="batchRenameModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>✏️ 파일 일괄 이름 변경</h3>
            <div class="batch-rename-content">
                <div class="selected-files-preview">
                    <h4>선택된 파일들:</h4>
                    <div id="selectedFilesList" class="selected-files-list"></div>
                </div>
                <div class="rename-options">
                    <div class="rename-option">
                        <label>
                            <input type="radio" name="renameType" value="prefix" checked>
                            앞에 추가하기
                        </label>
                        <input type="text" id="prefixText" placeholder="추가할 텍스트 입력">
                        <small>예: "게임_" → "게임_원래파일명.jpg"</small>
                    </div>
                    <div class="rename-option">
                        <label>
                            <input type="radio" name="renameType" value="suffix">
                            뒤에 추가하기 (확장자 앞)
                        </label>
                        <input type="text" id="suffixText" placeholder="추가할 텍스트 입력">
                        <small>예: "_edited" → "원래파일명_edited.jpg"</small>
                    </div>
                    <div class="rename-option">
                        <label>
                            <input type="radio" name="renameType" value="replace">
                            텍스트 교체하기
                        </label>
                        <div class="replace-inputs">
                            <input type="text" id="replaceFrom" placeholder="바꿀 텍스트">
                            <span>→</span>
                            <input type="text" id="replaceTo" placeholder="새 텍스트 (비우면 삭제)">
                        </div>
                        <small>예: "temp" → "final", "00" → "" (삭제)</small>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn">취소</button>
                    <button type="button" id="applyBatchRename" class="confirm-btn">변경 적용</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 카테고리 파일 일괄 이동 모달 -->
    <div class="modal" id="categoryBatchMoveModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>📁 파일 일괄 이동</h3>
            <div class="batch-move-content">
                <div class="selected-files-preview">
                    <h4>선택된 파일들:</h4>
                    <div id="categorySelectedFilesList" class="selected-files-list"></div>
                </div>
                <div class="move-options">
                    <h4>이동할 위치:</h4>
                    <div class="move-destination">
                        <label>
                            <input type="radio" name="moveDestination" value="download" checked>
                            📥 다운로드 폴더로 이동
                        </label>
                        <label>
                            <input type="radio" name="moveDestination" value="category">
                            📂 다른 카테고리로 이동
                        </label>
                        <select id="categoryMoveSelect" style="display: none; margin-top: 10px;">
                            <option value="">카테고리 선택</option>
                        </select>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn">취소</button>
                    <button type="button" id="applyCategoryBatchMove" class="confirm-btn">이동 실행</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 다운로드 파일 일괄 이동 모달 -->
    <div class="modal" id="downloadBatchMoveModal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>📁 파일 일괄 이동</h3>
            <div class="batch-move-content">
                <div class="selected-files-preview">
                    <h4>선택된 파일들:</h4>
                    <div id="downloadSelectedFilesList" class="selected-files-list"></div>
                </div>
                <div class="move-options">
                    <h4>이동할 카테고리:</h4>
                    <div class="move-destination">
                        <select id="downloadMoveSelect" style="width: 100%; padding: 10px; margin: 10px 0;">
                            <option value="">카테고리 선택</option>
                        </select>
                        <div class="move-option-note">
                            <small>💡 새 카테고리가 필요한 경우 먼저 카테고리를 생성해주세요.</small>
                        </div>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="cancel-btn">취소</button>
                    <button type="button" id="applyDownloadBatchMove" class="confirm-btn">이동 실행</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 드래그 오버레이 -->
    <div class="drag-overlay" id="dragOverlay" style="display: none;">
        <div class="drag-message">
            <h2>🎯 카테고리로 드래그하여 이동</h2>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="folder-manager.js"></script>
</body>
</html>