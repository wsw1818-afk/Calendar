<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>달력 메모 잔상 수정 테스트</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #5a67d8;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            border-left: 4px solid #667eea;
            margin: 10px 0;
        }
        .log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>📅 달력 메모 잔상 수정 테스트</h1>
    
    <div class="test-container">
        <h2>🐛 문제 상황</h2>
        <p>메모를 삭제한 후 모달을 닫았을 때 달력에 메모 인디케이터(●)와 개수가 남아있는 문제</p>
        
        <h3>🔧 적용된 수정사항</h3>
        <ul>
            <li class="success">updateCalendarDisplay() 함수에 50ms 지연 로직 추가</li>
            <li class="success">createCalendar() 함수에 디버깅 로그 추가</li>
            <li class="success">localStorage 데이터 동기화 개선</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>🧪 테스트 방법</h2>
        <ol>
            <li>메인 index.html 페이지에서 달력의 날짜 클릭</li>
            <li>메모를 여러 개 추가 (예: 3개)</li>
            <li>달력에 메모 인디케이터와 개수 표시 확인</li>
            <li>모달에서 메모 잠금 해제 후 메모 삭제</li>
            <li>모달 닫기 (X 버튼 또는 외부 클릭)</li>
            <li><strong>달력에서 메모 인디케이터와 개수가 올바르게 업데이트되는지 확인</strong></li>
        </ol>
    </div>

    <div class="test-container">
        <h2>🔍 수정 내용 상세</h2>
        
        <h3>1. updateCalendarDisplay 함수 (index.html:6061-6067)</h3>
        <div class="code">
function updateCalendarDisplay() {
    // 약간의 지연을 두어 localStorage 업데이트가 완료된 후 달력 업데이트
    setTimeout(() => {
        createCalendar(); // 달력을 다시 그려서 메모 표시를 업데이트
        console.log('📅 달력 표시 업데이트 완료 (지연 적용)');
    }, 50); // 50ms 지연
}
        </div>
        
        <h3>2. createCalendar 함수 디버깅 개선 (index.html:2291-2294)</h3>
        <div class="code">
// 디버깅: 메모 개수 로그
if (dateMemos.length > 0) {
    console.log(`📅 ${dateStr}: ${dateMemos.length}개 메모 발견`);
}
        </div>
    </div>

    <div class="test-container">
        <h2>✅ 예상 결과</h2>
        <ul>
            <li class="success">메모 삭제 후 모달 닫기 시 달력이 즉시 업데이트됨</li>
            <li class="success">삭제된 메모의 인디케이터와 개수가 올바르게 제거됨</li>
            <li class="success">콘솔에 "📅 달력 표시 업데이트 완료 (지연 적용)" 메시지 표시</li>
            <li class="success">남은 메모가 있는 경우 정확한 개수 표시</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>🔧 관련 함수들</h2>
        <ul>
            <li><code>closeDateMemoModal()</code> - 모달 닫기 시 updateCalendarDisplay() 호출</li>
            <li><code>updateCalendarDisplay()</code> - 50ms 지연 후 createCalendar() 호출</li>
            <li><code>createCalendar()</code> - localStorage에서 최신 메모 데이터 읽어와 달력 업데이트</li>
        </ul>
    </div>

    <div class="test-container">
        <h2>📋 테스트 결과 확인</h2>
        <div id="testLog" class="log">
브라우저 콘솔에서 다음 로그들을 확인하세요:

1. 메모 삭제 시:
   "✅ 메모 삭제됨: [ID] (X → Y)"

2. 모달 닫기 시:
   "🔒 closeDateMemoModal 호출됨"
   "🗓️ createCalendar 호출됨"
   "📅 달력 표시 업데이트 완료 (지연 적용)"

3. 메모 개수 확인:
   "📅 2025-08-31: X개 메모 발견"

이 로그들이 순차적으로 나타나면 수정이 제대로 적용된 것입니다.
        </div>
    </div>

    <script>
        console.log('🧪 달력 메모 잔상 수정 테스트 페이지 로드됨');
        console.log('📋 수정 내용: updateCalendarDisplay() 함수에 50ms 지연 로직 추가');
        console.log('🎯 목표: 메모 삭제 후 모달 닫기 시 달력 잔상 제거');
        
        // 테스트 도우미 함수
        window.checkLocalStorage = function() {
            const memos = JSON.parse(localStorage.getItem('calendarMemos') || '[]');
            console.log('📊 현재 저장된 메모:', memos.length + '개');
            memos.forEach((memo, index) => {
                console.log(`  ${index + 1}. ${memo.date}: ${memo.title}`);
            });
            return memos;
        };
        
        window.testCalendarUpdate = function() {
            console.log('🧪 달력 업데이트 테스트 시작');
            if (typeof updateCalendarDisplay === 'function') {
                updateCalendarDisplay();
                console.log('✅ updateCalendarDisplay 호출 완료');
            } else {
                console.error('❌ updateCalendarDisplay 함수를 찾을 수 없음');
            }
        };
        
        console.log('🛠️ 테스트 함수 사용 가능:');
        console.log('- checkLocalStorage(): 현재 메모 상태 확인');
        console.log('- testCalendarUpdate(): 달력 업데이트 테스트');
    </script>
</body>
</html>